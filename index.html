<!DOCTYPE html>
<html>
<head>
  <title>ë” ë§ˆì¸ë“œ! for ì¼ê³ ì‚¼ê³ </title>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --card-bg: #eee;
      --card-hover: #ddd;
      --border-color: #333;
    }

    body {
      font-family: sans-serif;
      text-align: center;
      margin: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    #playerList, #resources, #status {
      margin: 10px 0;
    }

    #cards, #playedCards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
    }

    .card {
      width: 50px;
      height: 70px;
      border: 1px solid var(--border-color);
      line-height: 70px;
      font-size: 18px;
      background-color: var(--card-bg);
      cursor: pointer;
      user-select: none;
      border-radius: 6px;
      box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
      transition: background-color 0.2s ease;
    }

    .card:hover {
      background-color: var(--card-hover);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    @media (max-width: 400px) {
      .card {
        width: 40px;
        height: 60px;
        font-size: 16px;
        line-height: 60px;
      }
    }
  </style>
</head>
<body>
  <h1>The Mind - Online</h1>

  <div>
    <label for="username">ì´ë¦„:</label>
    <input id="username" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
    <button onclick="joinGame()">ì°¸ê°€</button>
    <button onclick="toggleTheme()" style="margin-left: 10px;">ğŸŒ— í…Œë§ˆ ì „í™˜</button>
  </div>

  <div style="margin-top: 10px;">
    <button onclick="startGame()" disabled id="startBtn">ê²Œì„ ì‹œì‘</button>
    <button onclick="requestShuriken()" disabled id="shurikenBtn">ìˆ˜ë¦¬ê²€ ìš”ì²­</button>
    <button onclick="nextLevel()" style="display:none;" id="nextLevelBtn">ë‹¤ìŒ ë ˆë²¨</button>
    <button onclick="confirmReset()" style="margin-left: 10px;">ğŸ”„ ê²Œì„ ì´ˆê¸°í™”</button>
  </div>

  <div id="playerList"></div>
  <div id="playerCardsCount" style="margin-bottom: 10px;"></div>
  <div id="resources"></div>

  <h3>ë‚´ ì¹´ë“œ</h3>
  <div id="cards"></div>

  <h3>ê¹”ë¦° ì¹´ë“œ</h3>
  <div id="playedCards"></div>

  <div id="status"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let hand = [];
    let played = [];
    let playerName = null;
    let isDark = false;

    function joinGame() {
      const input = document.getElementById('username');
      if (!input.value.trim()) {
        alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }
      playerName = input.value.trim();
      socket.emit('join', playerName);
      input.disabled = true;
      input.nextElementSibling.disabled = true;
      document.getElementById('startBtn').disabled = false;
      document.getElementById('shurikenBtn').disabled = false;
    }

    function startGame() {
      socket.emit('start');
      document.getElementById('status').innerText = 'ê²Œì„ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤!';
      document.getElementById('nextLevelBtn').style.display = 'none';
    }

    function requestShuriken() {
      socket.emit('request-shuriken');
    }

    function nextLevel() {
      socket.emit('next-level');
      document.getElementById('nextLevelBtn').style.display = 'none';
      document.getElementById('status').innerText = 'ë‹¤ìŒ ë ˆë²¨ë¡œ ì´ë™ ì¤‘...';
    }

    function confirmReset() {
      if (confirm('ì •ë§ë¡œ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë ˆë²¨ê³¼ ì¹´ë“œê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) {
        socket.emit('force-reset');
      }
    }

    function toggleTheme() {
      isDark = !isDark;
      if (isDark) {
        document.documentElement.style.setProperty('--bg-color', '#121212');
        document.documentElement.style.setProperty('--text-color', '#ffffff');
        document.documentElement.style.setProperty('--card-bg', '#333');
        document.documentElement.style.setProperty('--card-hover', '#444');
        document.documentElement.style.setProperty('--border-color', '#aaa');
      } else {
        document.documentElement.style.setProperty('--bg-color', '#ffffff');
        document.documentElement.style.setProperty('--text-color', '#000000');
        document.documentElement.style.setProperty('--card-bg', '#eee');
        document.documentElement.style.setProperty('--card-hover', '#ddd');
        document.documentElement.style.setProperty('--border-color', '#333');
      }
    }

    function renderCards() {
      const container = document.getElementById('cards');
      container.innerHTML = '';
      hand.forEach((card) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerText = card;
        div.onclick = () => {
          socket.emit('play', card);
          div.style.backgroundColor = 'gray';
          div.onclick = null;
        };
        container.appendChild(div);
      });
    }

    function renderPlayedCards() {
      const playedContainer = document.getElementById('playedCards');
      playedContainer.innerHTML = '';
      played.sort((a, b) => a - b);
      played.forEach(card => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        cardDiv.innerText = card;
        playedContainer.appendChild(cardDiv);
      });
    }

    socket.on('hand', (cards) => {
      hand = cards;
      played = [];
      renderCards();
      document.getElementById('playedCards').innerHTML = '';
    });

    socket.on('played', (data) => {
      played.push(data.card);
      renderPlayedCards();
      document.getElementById('status').innerText = `${data.by}ë‹˜ì´ ${data.card} ì¹´ë“œë¥¼ ëƒˆìŠµë‹ˆë‹¤.`;
    });

    socket.on('playerList', (players) => {
      document.getElementById('playerList').innerHTML = '<b>í”Œë ˆì´ì–´:</b> ' + players.map(p => p.name).join(', ');
    });

    socket.on('player-card-counts', (counts) => {
      document.getElementById('playerCardsCount').innerText =
        counts.map(c => `${c.name}: ${c.count}ì¥`).join(' | ');
    });

    socket.on('update-resources', ({ lives, shuriken, level }) => {
      document.getElementById('resources').innerText = `â¤ï¸ ìƒëª…: ${lives}  |  ğŸ¥· ìˆ˜ë¦¬ê²€: ${shuriken}  |  ğŸ¯ ë ˆë²¨: ${level}`;
    });

    socket.on('shuriken-used', (minCards) => {
      minCards.forEach(card => played.push(card));
      renderPlayedCards();
      document.getElementById('status').innerText = `ğŸ¥· ìˆ˜ë¦¬ê²€ì´ ì‚¬ìš©ë˜ì–´ ${minCards.join(', ')} ì¹´ë“œê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.`;
    });

    socket.on('life-lost', () => {
      alert('í‹€ë¦° ìˆœì„œ! ğŸ’” ìƒëª…ì´ 1ê°œ ì¤„ì—ˆìŠµë‹ˆë‹¤.');
    });

    socket.on('game-over', (msg) => {
      alert(msg);
      document.getElementById('status').innerText = msg;
      document.getElementById('nextLevelBtn').style.display = 'inline-block';
    });

    socket.on('game-won', () => {
      document.getElementById('status').innerText = 'ğŸ‰ ì‹ ì´ ë˜ì—ˆìŠµë‹ˆë‹¤! ê²Œì„ í´ë¦¬ì–´!!';
      document.getElementById('nextLevelBtn').style.display = 'inline-block';
    });

    socket.on('shuriken-requested', (votes) => {
      document.getElementById('status').innerText = `ğŸ¥· ìˆ˜ë¦¬ê²€ ìš”ì²­ ì¤‘... (${votes.length}ëª… ë™ì˜)`;
    });

    socket.on('next-level-status', ({ count, total }) => {
      document.getElementById('status').innerText = `ğŸ¯ ë‹¤ìŒ ë ˆë²¨ íˆ¬í‘œ ì¤‘... (${count}/${total})`;
    });

    socket.on('status', (msg) => {
      document.getElementById('status').innerText = msg;
    });
  </script>
</body>
</html>
